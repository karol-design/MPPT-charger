Dear Dr. Zhang (cheng.zhang@manchester.ac.uk)

Since February, I am working on a small project to use the theoretical knowledge from the 1st and 2nd semesters and try applying it in the real world. 

I am trying to design and build a simple MPPT charge controller for a small PV panel (10W) and a lead-acid battery (12V, 7Ah). The core is a DC/DC buck converter that I decided to base on the LM2576-ADJ chip. Its Vout can be quite simply regulated by providing a feedback loop that stabilizes the Vout at a preset level ( the regulator aims for a constant 1.235 V on its feedback pin).

To adjust the output voltage, I use a simple, but maybe weird, configuration that I came up with, in which the voltage divider circuit (which functions as a feedback loop) is connected from one side to the reference voltage instead of being connected to the ground. If the reference voltage is set to 0V, then the circuit works as it would have only the simple voltage divider feedback. On the other hand, increasing the reference voltage (e.g. to 100/200 mV) decreases the output voltage adequately.

I have already tested the circuit (utilizing also the tools provided by the University like myDAQ :) ) and while using the DAC from myDAQ to set the reference voltage all worked as I assumed. However, ultimately I would like to use a microcontroller (Atmega 328) and its PWM signal (490 Hz) connected through a low-pass RC filter and a buffer op-amp. Unfortunately, when I tested this configuration I was able to change the voltage passed to the op-amp by varying the duty cycle of PWM as predicted, but the output of the op-amp stayed the same at 690 mV, and hence I had no control over the output voltage.

What can be the issue? Is using a microcontroller's PWM signal a good idea, or maybe I should try to look for some external DAC ICs? Or maybe PWM is not a bad idea, but the problem is in the feedback circuit (RC filter/op-amp/voltage divider)?
I'm enclosing the current version of the schematics of the charge controller.

I would be very thankful for any advice on the feedback circuit. I would also truly appreciate any suggestions that come to your mind regarding the whole project.

Thank you,
Karol Wojslaw
BEng Electronic Engineering, 1st year